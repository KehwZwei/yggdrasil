> __该模块实现在`Spring Boot`项目中缓存的自动配置和加载__

---

## i. 功能

- 本地缓存
- `Redis`缓存
- 混合缓存
- 内容压缩

---

## ii. 使用

### 1. 依赖

__1.1 引入`maven`依赖__

``` xml
<dependency>
    <groupId>org.s3s3l.yggdrasil</groupId>
    <artifactId>yggdrasil-cache-spring-boot-starter</artifactId>
</dependency>
```

---

### 2. 缓存配置

``` yaml
yggdrasil:
  cache:
    enable: true # 组件开关
    version-redis: asgard # 缓存版本控制Redis，与redis配置中的名称对应
    data-redis: apidata # 数据缓存Redis，与redis配置中的名称对应
    remote-expire-after-write: 600 # 远程缓存失效时间，单位：秒
    local-expire-after-access: 600 # 本地缓存访问后失效时间，单位：秒
    local-expire-after-write: 600 # 本地缓存写入后失效时间，单位：秒
    local-max-num: 500 # 本地缓存最大数量，改配置为个数，最终缓存占用以单个对象大小×缓存个数为准
    compressor-supplier: org.s3s3l.yggdrasil.utils.compressor.DefaultZstdCompressSupliers # 压缩器提供者，任意实现Supplier<Compressor>的类全路径
    compress: # 压缩配置
      compress-key: true # 是否对key进行压缩，默认为false
      compress-value: true # 是否对value进行压缩，默认为false
      key-config:
        level: 18 # key的压缩级别，默认为0
      value-config:
        level: 18 # value的压缩级别，默认为0
        ignore-null-value: true # 是否忽略null值，默认为false，当为true时，value为null会抛出错误
```

---

### 3. 直接使用

__3.1 该组件在启动过程中会注入如下几类`Bean`__

- `org.s3s3l.yggdrasil.utils.cache.helper.ComplexCacheHelper<byte[], byte[]>`
    - BeanName: `complexCacheHelper`
- `org.s3s3l.yggdrasil.utils.interceptor.ComplexCacheInterceptor`
    - BeanName: `complexCacheInterceptor`

__3.2 构建缓存__

``` java
@Service
public class YourService {

    @Resource
    private ComplexCacheHelper<byte[], byte[]> cache;

    public QueryResult query(QueryRequest request) {
        QueryResult data = doSomeThingToGetResult(request);

        byte[] cacheValue = convertDataToByteArray(data);

        byte[] cacheKey = generateCacheKey(request);

        cache.update(cacheKey, cacheValue, "your-cache-scope");

        return data;
    }
}
```

__3.3 获取缓存__

``` java
@Service
public class YourService {

    @Resource
    private ComplexCacheHelper<byte[], byte[]> cache;

    public QueryResult query(QueryRequest request) {
        private String cacheScope = "your-cache-scope";

        byte[] cacheKey = generateCacheKey(request);

        byte[] cacheData = cache.get(cacheKey, cacheScope);

        if (cacheData != null){
            return convertByteArrayToResult(cacheData);
        }

        QueryResult data = doSomeThingToGetResult(request);

        byte[] cacheValue = convertDataToByteArray(data);

        cache.update(cacheKey, cacheValue, cacheScope);

        return data;
    }
}
```

__3.3 失效缓存__

``` java
@Service
public class YourService {

    @Resource
    private ComplexCacheHelper<byte[], byte[]> cache;

    private String cacheScope = "your-cache-scope";

    public QueryResult query(QueryRequest request) {

        byte[] cacheKey = generateCacheKey(request);

        byte[] cacheData = cache.get(cacheKey, cacheScope);
        
        if (cacheData != null){
            return convertByteArrayToResult(cacheData);
        }

        QueryResult data = doSomeThingToGetResult(request);

        byte[] cacheValue = convertDataToByteArray(data);

        cache.update(cacheKey, cacheValue, cacheScope);

        return data;
    }

    public ChangeResult change(ChangeRequest request) {
        ChangeResult result = doSomeChange(request);

        cache.expire(cacheScope);

        return result;
    }
}
```

---

## iii. 子模块

- `CacheConfiguration`
    - 缓存配置
- `CacheAutoConfigure`
    - 缓存自动配置