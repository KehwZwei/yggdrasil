> __该模块实现在`Spring Boot`项目中`Redis`的自动配置和加载__

---

## i. 功能

- 多`Redis`实例
- 读写分离
- `Cluster`支持

---

## ii. 使用

### 1. 依赖

__1.1 引入`maven`依赖__

``` xml
<dependency>
    <groupId>org.s3s3l.yggdrasil</groupId>
    <artifactId>yggdrasil-redis-spring-boot-starter</artifactId>
</dependency>
```

---

### 2. `master-slave`读写分离配置

``` yaml
yggdrasil:
  redis:
    enable: true # 组件开关
    primary: ${your-primary-IRedis-bean} # 定义主要的IRedis Bean
    masterSlave:
      your-first-redis:
        master:
          host: ${your-first-redis-master-host}
          port: ${your-first-redis-master-port}
          passowrd: ${your-first-redis-master-password}
          database: ${database-number}
          timeout: ${timeout}
          jedis:
            pool: # some pool config
              maxActive: ...
              maxIdle: ...
              maxWait: ...
              minIdle: ...
              ...
        slave: 
          host: ${your-first-redis-slave-host}
          port: ${your-first-redis-slave-port}
          passowrd: ${your-first-redis-slave-password}
          database: ${database-number}
          timeout: ${timeout}
          jedis:
            pool: # some pool config
              maxActive: ...
              maxIdle: ...
              maxWait: ...
              minIdle: ...
              ...
      your-second-redis:
        master:
          host: ${your-second-redis-master-host}
          port: ${your-second-redis-master-port}
          passowrd: ${your-second-redis-master-password}
          database: ${database-number}
          timeout: ${timeout}
          jedis:
            pool: # some pool config
              maxActive: ...
              maxIdle: ...
              maxWait: ...
              minIdle: ...
              ...
        slave: 
          host: ${your-second-redis-slave-host}
          port: ${your-second-redis-slave-port}
          passowrd: ${your-second-redis-slave-password}
          database: ${database-number}
          timeout: ${timeout}
          jedis:
            pool: # some pool config
              maxActive: ...
              maxIdle: ...
              maxWait: ...
              minIdle: ...
              ...
      ... # more redis instance config
```

### 3. `Cluster`配置

``` yaml
yggdrasil:
  redis:
    enable: true # 组件开关
    primary: ${your-primary-IRedis-bean} # 定义主要的IRedis Bean
    cluster: 
      your-first-cluster:
        cluster-config:
        - host: ${first-node-host}
          port: ${first-node-port}
        - host: ${second-node-host}
          port: ${second-node-port}
        ... # more node config
        poolConfig: # some pool config
          maxTotal: ...
          maxIdle: ...
          maxWaitMillis: ...
          minIdle: ...
          testOnBorrow: ...
      your-second-cluster:
        cluster-config:
        - host: ${first-node-host}
          port: ${first-node-port}
        - host: ${second-node-host}
          port: ${second-node-port}
        ... # more node config
        poolConfig: # some pool config
          maxTotal: ...
          maxIdle: ...
          maxWaitMillis: ...
          minIdle: ...
          testOnBorrow: ...
```

---

### 4. `Redis`实例选择配置

``` yaml
yggdrasil:
  redis:
    enable: true # 组件开关
    primary: ${your-primary-IRedis-bean} # 定义主要的IRedis Bean
    required-instances: # 该配置用于限制只初始化指定的Redis，如未配置，则初始化所有已配置的Redis
    - ${your-redis-name}
```

---

### 5. 在服务中使用

__5.1 该组件在启动过程中会注入如下几类`Bean`__

- `org.s3s3l.yggdrasil.utils.redis.JedisClusterHelper`
    - 以`${your-redis-name}` + `Redis`作为`BeanName`
- `org.s3s3l.yggdrasil.utils.redis.RedisClusterHelper`
    - 以`${your-redis-name}` + `RedisCluster`作为`BeanName`

__5.2 使用__

``` java
@Service
public class YourService {
  @Resource(name="${beanName}") // 参考6.1的命名
  private IRedis redis;
}
```

---

## iii. 子模块

- `DefaultRedisClientConfiguration`
    - `Redis`配置
- `MultiRedisAutoConfigure`
    - `Redis`自动配置
- __feature__
    - `RedisConfigurationResolver`
        - `Redis`配置解析器
    - `RedisClientConfigFileChangedProcessor`
        - 配置文件变更处理器，与`yggdrasil-apollo-spring-boot-starter`结合使用